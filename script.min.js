const navToggle=document.getElementById('navToggle'),navMenu=document.getElementById('navMenu'),drawerOverlay=document.getElementById('drawerOverlay'),navLinks=document.querySelectorAll('.nav-link');function toggleDrawer(){navToggle.classList.toggle('active'),navMenu.classList.toggle('active'),drawerOverlay.classList.toggle('active'),navMenu.classList.contains('active')?document.body.style.overflow='hidden':document.body.style.overflow=''}function closeDrawer(){navToggle.classList.remove('active'),navMenu.classList.remove('active'),drawerOverlay.classList.remove('active'),document.body.style.overflow=''}navToggle&&navMenu&&drawerOverlay&&(navToggle.addEventListener('click',toggleDrawer),drawerOverlay.addEventListener('click',closeDrawer),navLinks.forEach(e=>{e.addEventListener('click',()=>{navMenu.classList.contains('active')&&closeDrawer()})}),document.addEventListener('keydown',e=>{'Escape'===e.key&&navMenu.classList.contains('active')&&closeDrawer()}));let resizeTimer;window.addEventListener('resize',()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout(()=>{window.innerWidth>768&&navMenu.classList.contains('active')&&closeDrawer()},250)});const RECAPTCHA_SITE_KEY='6LcGQ1UsAAAAAOpxC9KvEF44k6grvzSrACoU_Wd3';let mainRecaptchaWidgetId,thankyouRecaptchaWidgetId,isRecaptchaLoaded=!1;function loadRecaptcha(){if(!isRecaptchaLoaded){isRecaptchaLoaded=!0;const e=document.createElement('script');e.src='https://www.google.com/recaptcha/enterprise.js?render=explicit&onload=initRecaptcha',e.async=!0,e.defer=!0,document.head.appendChild(e)}}function attachRecaptchaTriggers(){[document.getElementById('emailInput'),document.getElementById('thankyouEmailInput'),document.getElementById('sendBtn'),document.getElementById('thankyouSendBtn')].forEach(e=>{e&&(e.addEventListener('focus',loadRecaptcha,{once:!0}),e.addEventListener('click',loadRecaptcha,{once:!0}),'BUTTON'===e.tagName&&e.addEventListener('mouseover',loadRecaptcha,{once:!0}))});const e=()=>{!isRecaptchaLoaded&&window.scrollY+window.innerHeight>document.documentElement.scrollHeight-1e3&&(loadRecaptcha(),window.removeEventListener('scroll',e))};window.addEventListener('scroll',e,{passive:!0})}document.readyState==='loading'?document.addEventListener('DOMContentLoaded',attachRecaptchaTriggers):attachRecaptchaTriggers(),window.initRecaptcha=function(){const e=document.getElementById('recaptcha-main');e&&(mainRecaptchaWidgetId=grecaptcha.enterprise.render('recaptcha-main',{sitekey:RECAPTCHA_SITE_KEY,action:'CONTACT_FORM_SUBMIT'}));const t=document.getElementById('recaptcha-thankyou');t&&(thankyouRecaptchaWidgetId=grecaptcha.enterprise.render('recaptcha-thankyou',{sitekey:RECAPTCHA_SITE_KEY,action:'CONTACT_FORM_SUBMIT'}))};async function handleFormSubmit(e,t,n){const o=document.getElementById(e),a=document.getElementById(t);if(o&&a){const c=o.value.trim(),r=a.textContent;if(!c||!isValidEmail(c))return o.focus(),o.style.borderColor='#f44336',void setTimeout(()=>{o.style.borderColor=''},2e3);if(void 0===n)return void alert('Please wait for the captcha to load.');const i=grecaptcha.enterprise.getResponse(n);if(!i)return void alert('Please complete the captcha verification.');a.disabled=!0,a.textContent='Sending...';try{const e=await fetch('api/contact.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:c,recaptchaToken:i})}),n=await e.json();if(!e.ok||!n.success)throw new Error(n.message||'Failed to send message');console.log('Message sent successfully:',n),a.textContent='Sent!',a.style.background='linear-gradient(135deg, #4CAF50 0%, #45a049 100%)',o.value='',grecaptcha.enterprise.reset(n),setTimeout(()=>{a.textContent=r,a.style.background='',a.disabled=!1},3e3)}catch(e){console.error('Error:',e),a.textContent='Error',a.style.background='linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',setTimeout(()=>{a.textContent=r,a.style.background='',a.disabled=!1},3e3)}}}const sendBtn=document.getElementById('sendBtn');if(sendBtn){sendBtn.addEventListener('click',function(e){e.preventDefault(),e.stopPropagation(),handleFormSubmit('emailInput','sendBtn',mainRecaptchaWidgetId)});const e=document.getElementById('emailInput');e&&e.addEventListener('keypress',function(t){'Enter'===t.key&&(t.preventDefault(),handleFormSubmit('emailInput','sendBtn',mainRecaptchaWidgetId))})}const thankyouSendBtn=document.getElementById('thankyouSendBtn');if(thankyouSendBtn){thankyouSendBtn.addEventListener('click',function(e){e.preventDefault(),e.stopPropagation(),handleFormSubmit('thankyouEmailInput','thankyouSendBtn',thankyouRecaptchaWidgetId)});const e=document.getElementById('thankyouEmailInput');e&&e.addEventListener('keypress',function(t){'Enter'===t.key&&(t.preventDefault(),handleFormSubmit('thankyouEmailInput','thankyouSendBtn',thankyouRecaptchaWidgetId))})}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}const projectPopupOverlay=document.getElementById('projectPopupOverlay'),popupClose=document.getElementById('popupClose'),btnWeb=document.getElementById('btnWeb'),btnAndroid=document.getElementById('btnAndroid'),btnIOS=document.getElementById('btnIOS'),projectCards=document.querySelectorAll('.project-card');let redirectTimer;function openPopup(e,t,n){redirectTimer&&(clearTimeout(redirectTimer),redirectTimer=null);const o=document.querySelector('.project-popup');o&&o.dataset.intervalId&&(clearInterval(parseInt(o.dataset.intervalId)),delete o.dataset.intervalId);const a=document.getElementById('redirect-countdown');a&&a.remove();let c=0,r='';btnWeb&&(e&&'#'!==e?(btnWeb.href=e,btnWeb.style.display='flex',c++,r=e):btnWeb.style.display='none'),btnAndroid&&(t&&'#'!==t&&''!==t?(btnAndroid.href=t,btnAndroid.style.display='flex',c++,r=t):btnAndroid.style.display='none'),btnIOS&&(n&&'#'!==n&&''!==n?(btnIOS.href=n,btnIOS.style.display='flex',c++,r=n):btnIOS.style.display='none'),projectPopupOverlay&&(projectPopupOverlay.classList.add('active'),document.body.style.overflow='hidden'),1===c&&r&&(()=>{const e=document.createElement('p');e.id='redirect-countdown',e.style.marginTop='15px',e.style.fontSize='0.9rem',e.style.color='#666',e.style.fontWeight='500',e.innerHTML='Redirecting in <span id="countdown-timer">5</span> seconds...',o&&(o.appendChild(e),(()=>{let e=5;const t=document.getElementById('countdown-timer'),n=setInterval(()=>{e--,t&&(t.textContent=e),e<=0&&clearInterval(n)},1e3);o.dataset.intervalId=n,redirectTimer=setTimeout(()=>{const e=window.open(r,'_blank');e&&e.focus(),closePopup()},5e3)})())})()}function closePopup(){redirectTimer&&(clearTimeout(redirectTimer),redirectTimer=null);const e=document.querySelector('.project-popup');e&&e.dataset.intervalId&&(clearInterval(parseInt(e.dataset.intervalId)),delete e.dataset.intervalId);const t=document.getElementById('redirect-countdown');t&&t.remove(),projectPopupOverlay&&(projectPopupOverlay.classList.remove('active'),document.body.style.overflow='')}popupClose&&popupClose.addEventListener('click',closePopup),projectPopupOverlay&&projectPopupOverlay.addEventListener('click',e=>{e.target===projectPopupOverlay&&closePopup()}),document.addEventListener('keydown',e=>{'Escape'===e.key&&projectPopupOverlay&&projectPopupOverlay.classList.contains('active')&&closePopup()}),projectCards.forEach(e=>{e.addEventListener('click',()=>{openPopup(e.dataset.web,e.dataset.android,e.dataset.ios)})});const navbar=document.querySelector('.navbar');if(navbar){let e=window.scrollY,t;function n(){clearTimeout(t),window.scrollY<50||(t=setTimeout(()=>{window.scrollY<50||navbar.classList.add('nav-hidden')},5e3))}n();let o=!1;window.addEventListener('scroll',()=>{(o||(window.requestAnimationFrame(()=>{const t=window.scrollY;t>50?(navbar.classList.add('nav-hidden'),clearTimeout(n)):navbar.classList.remove('nav-hidden'),e=t,o=!1}),o=!0))});let a=!1;window.addEventListener('mousemove',e=>{(a||e.clientY<=100&&(window.requestAnimationFrame(()=>{navbar.classList.remove('nav-hidden'),n(),a=!1}),a=!0))}),navbar.addEventListener('mouseenter',()=>{clearTimeout(t),navbar.classList.remove('nav-hidden')}),navbar.addEventListener('mouseleave',()=>{n()})}const filterButtons=document.querySelectorAll('.filter-btn'),filterableCards=document.querySelectorAll('.project-card');filterButtons.length>0&&filterableCards.length>0&&filterButtons.forEach(e=>{e.addEventListener('click',()=>{filterButtons.forEach(e=>e.classList.remove('active')),e.classList.add('active');const t=e.getAttribute('data-filter');filterableCards.forEach(e=>{const n=e.getAttribute('data-category');e.classList.remove('show','hide'),setTimeout(()=>{'all'===t||n&&n.includes(t)?(e.style.display='block',requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.classList.add('show')})})):(e.classList.add('hide'),setTimeout(()=>{e.classList.contains('hide')&&(e.style.display='none')},400))},10)})})});
